<!DOCTYPE html>

<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>愛知県世帯年収ヒートマップ</title>

```
<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />

<style>
    body {
        margin: 0;
        padding: 0;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    #map {
        height: 100vh;
        width: 100%;
    }
    
    .info {
        padding: 8px 12px;
        font: 14px/16px Arial, Helvetica, sans-serif;
        background: white;
        background: rgba(255,255,255,0.95);
        box-shadow: 0 0 15px rgba(0,0,0,0.2);
        border-radius: 8px;
        backdrop-filter: blur(10px);
    }
    
    .info h4 {
        margin: 0 0 8px;
        color: #333;
        font-size: 16px;
        font-weight: bold;
    }
    
    .legend {
        line-height: 20px;
        color: #555;
    }
    
    .legend i {
        width: 18px;
        height: 18px;
        float: left;
        margin-right: 8px;
        opacity: 0.9;
        border-radius: 3px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    }
    
    .info-details {
        margin-top: 10px;
        padding-top: 10px;
        border-top: 1px solid #ddd;
    }
    
    .info-details p {
        margin: 5px 0;
        font-size: 13px;
    }
    
    .loading {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 20px 40px;
        border-radius: 10px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        z-index: 1000;
        font-size: 16px;
        color: #333;
    }
    
    .stats-panel {
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(255,255,255,0.95);
        padding: 10px 15px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        z-index: 1000;
        font-size: 12px;
    }
    
    .stats-panel h5 {
        margin: 0 0 5px 0;
        font-size: 14px;
    }
</style>
```

</head>
<body>
    <div id="loading" class="loading">地図データを読み込み中...</div>
    <div id="map"></div>
    <div class="stats-panel">
        <h5>📊 データポイント統計</h5>
        <p id="dataPoints">計算中...</p>
    </div>

```
<!-- Leaflet JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
<!-- Leaflet Heat -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.heat/0.2.0/leaflet-heat.js"></script>

<script>
    // 愛知県の詳細な地域別世帯年収データ（実際の統計データに基づく推計値）
    const detailedIncomeData = {
        // 名古屋市 - 区ごとに詳細化
        "名古屋市千種区": {
            income: 680,
            subAreas: {
                "本山": 720, "覚王山": 710, "東山": 700, "池下": 670,
                "今池": 650, "千種": 660, "吹上": 640, "春岡": 630
            }
        },
        "名古屋市東区": {
            income: 650,
            subAreas: {
                "高岳": 680, "泉": 670, "東桜": 660, "葵": 640,
                "代官町": 630, "白壁": 690, "主税町": 650
            }
        },
        "名古屋市北区": {
            income: 520,
            subAreas: {
                "黒川": 540, "大曽根": 550, "平安": 510, "志賀": 500,
                "楠": 490, "如意": 480, "味鋺": 470
            }
        },
        "名古屋市西区": {
            income: 540,
            subAreas: {
                "浄心": 560, "庄内通": 550, "上小田井": 540, "中小田井": 530,
                "栄生": 570, "名駅西": 580, "枇杷島": 510
            }
        },
        "名古屋市中村区": {
            income: 510,
            subAreas: {
                "名駅": 620, "国際センター": 600, "中村公園": 480,
                "本陣": 470, "亀島": 550, "太閤通": 520
            }
        },
        "名古屋市中区": {
            income: 620,
            subAreas: {
                "栄": 700, "伏見": 680, "丸の内": 670, "大須": 580,
                "金山": 600, "鶴舞": 590, "上前津": 570
            }
        },
        "名古屋市昭和区": {
            income: 640,
            subAreas: {
                "八事": 680, "いりなか": 660, "川名": 650, "御器所": 620,
                "桜山": 630, "鶴舞": 610, "吹上": 600
            }
        },
        "名古屋市瑞穂区": {
            income: 630,
            subAreas: {
                "瑞穂運動場": 650, "新瑞橋": 640, "桜山": 630,
                "瑞穂通": 620, "堀田": 600, "妙音通": 610
            }
        },
        "名古屋市熱田区": {
            income: 550,
            subAreas: {
                "神宮前": 570, "金山": 580, "熱田": 540, "日比野": 530,
                "六番町": 520, "伝馬": 510
            }
        },
        "名古屋市中川区": {
            income: 480,
            subAreas: {
                "高畑": 500, "八田": 490, "中島": 470, "荒子": 460,
                "尾頭橋": 510, "山王": 480, "露橋": 450
            }
        },
        "名古屋市港区": {
            income: 460,
            subAreas: {
                "港陽": 480, "築地口": 470, "東海通": 460, "名港": 450,
                "稲永": 440, "野跡": 430, "当知": 420
            }
        },
        "名古屋市南区": {
            income: 470,
            subAreas: {
                "笠寺": 490, "新瑞橋": 500, "道徳": 460, "豊田": 450,
                "大江": 440, "柴田": 470, "鳴尾": 430
            }
        },
        "名古屋市守山区": {
            income: 530,
            subAreas: {
                "小幡": 550, "喜多山": 540, "大森": 530, "瓢箪山": 520,
                "志段味": 510, "吉根": 500, "上志段味": 490
            }
        },
        "名古屋市緑区": {
            income: 580,
            subAreas: {
                "徳重": 610, "平手": 600, "神沢": 590, "鳴海": 570,
                "有松": 560, "大高": 550, "南大高": 540
            }
        },
        "名古屋市名東区": {
            income: 660,
            subAreas: {
                "星ヶ丘": 700, "一社": 680, "上社": 670, "本郷": 650,
                "藤が丘": 690, "猪高台": 640, "極楽": 630
            }
        },
        "名古屋市天白区": {
            income: 590,
            subAreas: {
                "八事": 620, "塩釜口": 600, "植田": 590, "原": 580,
                "平針": 570, "野並": 560, "相生山": 550
            }
        },
        
        // 主要都市の詳細データ
        "豊橋市": {
            income: 520,
            subAreas: {
                "豊橋駅前": 550, "向山": 540, "牟呂": 530, "汐田": 510,
                "前田": 500, "二川": 520, "吉田": 490
            }
        },
        "岡崎市": {
            income: 550,
            subAreas: {
                "康生": 580, "岡崎駅前": 570, "六名": 560, "矢作": 540,
                "美合": 530, "本宿": 520, "藤川": 510
            }
        },
        "一宮市": {
            income: 490,
            subAreas: {
                "一宮駅前": 520, "尾西": 480, "木曽川": 470, "今伊勢": 490,
                "奥町": 500, "萩原": 460, "千秋": 450
            }
        },
        "春日井市": {
            income: 540,
            subAreas: {
                "勝川": 560, "春日井駅前": 550, "高蔵寺": 530, "神領": 540,
                "味美": 520, "牛山": 510, "鷹来": 500
            }
        },
        "豊田市": {
            income: 580,
            subAreas: {
                "豊田市駅前": 610, "三河豊田": 590, "上郷": 570, "高岡": 560,
                "猿投": 550, "保見": 530, "足助": 480, "稲武": 450
            }
        },
        "刈谷市": {
            income: 620,
            subAreas: {
                "刈谷駅前": 650, "刈谷市役所": 630, "富士松": 610, "東刈谷": 600,
                "野田": 590, "一ツ木": 580
            }
        },
        "安城市": {
            income: 570,
            subAreas: {
                "安城駅前": 590, "三河安城": 600, "新安城": 570, "桜井": 550,
                "北安城": 540, "東刈谷": 560
            }
        },
        "小牧市": {
            income: 530,
            subAreas: {
                "小牧駅前": 550, "小牧原": 540, "味岡": 530, "篠岡": 510,
                "北里": 500, "南部": 490
            }
        },
        "長久手市": {
            income: 670,
            subAreas: {
                "藤が丘": 700, "はなみずき通": 690, "杁ヶ池": 680,
                "長久手古戦場": 660, "芸大通": 650
            }
        },
        "日進市": {
            income: 620,
            subAreas: {
                "日進駅前": 640, "赤池": 650, "米野木": 610, "香久山": 630,
                "岩崎": 600, "五色園": 590
            }
        },
        "みよし市": {
            income: 640,
            subAreas: {
                "三好ヶ丘": 670, "黒笹": 650, "福谷": 630, "莇生": 620,
                "明知": 610
            }
        },
        "東海市": {
            income: 540,
            subAreas: {
                "太田川": 560, "尾張横須賀": 530, "高横須賀": 520,
                "加木屋": 540, "南加木屋": 550
            }
        },
        "大府市": {
            income: 580,
            subAreas: {
                "大府駅前": 600, "共和": 590, "共栄": 570, "東浦": 560,
                "北崎": 550
            }
        }
    };

    // より細かい座標データを生成
    const cityCoordinates = {
        // 名古屋市各区の座標
        "名古屋市千種区": [35.1667, 136.9467],
        "本山": [35.1620, 136.9650],
        "覚王山": [35.1580, 136.9550],
        "東山": [35.1560, 136.9720],
        "池下": [35.1690, 136.9520],
        "今池": [35.1650, 136.9380],
        "千種": [35.1700, 136.9450],
        "吹上": [35.1600, 136.9420],
        "春岡": [35.1750, 136.9550],
        
        "名古屋市東区": [35.1783, 136.9267],
        "高岳": [35.1720, 136.9250],
        "泉": [35.1750, 136.9180],
        "東桜": [35.1780, 136.9220],
        "葵": [35.1810, 136.9290],
        "代官町": [35.1830, 136.9320],
        "白壁": [35.1850, 136.9280],
        "主税町": [35.1760, 136.9300],
        
        "名古屋市北区": [35.1950, 136.9117],
        "黒川": [35.1880, 136.9100],
        "大曽根": [35.1920, 136.9250],
        "平安": [35.1980, 136.9050],
        "志賀": [35.2000, 136.9200],
        "楠": [35.2050, 136.9150],
        "如意": [35.2100, 136.9100],
        "味鋺": [35.2150, 136.9000],
        
        "名古屋市西区": [35.1900, 136.8900],
        "浄心": [35.1850, 136.8850],
        "庄内通": [35.1920, 136.8780],
        "上小田井": [35.2000, 136.8650],
        "中小田井": [35.1980, 136.8700],
        "栄生": [35.1780, 136.8850],
        "名駅西": [35.1700, 136.8750],
        "枇杷島": [35.2020, 136.8550],
        
        "名古屋市中村区": [35.1650, 136.8733],
        "名駅": [35.1700, 136.8820],
        "国際センター": [35.1680, 136.8900],
        "中村公園": [35.1580, 136.8650],
        "本陣": [35.1620, 136.8550],
        "亀島": [35.1720, 136.8780],
        "太閤通": [35.1600, 136.8700],
        
        "名古屋市中区": [35.1686, 136.9109],
        "栄": [35.1680, 136.9080],
        "伏見": [35.1700, 136.9000],
        "丸の内": [35.1750, 136.9050],
        "大須": [35.1600, 136.9050],
        "金山": [35.1430, 136.9010],
        "鶴舞": [35.1550, 136.9180],
        "上前津": [35.1580, 136.9000],
        
        "名古屋市昭和区": [35.1500, 136.9333],
        "八事": [35.1420, 136.9380],
        "いりなか": [35.1450, 136.9350],
        "川名": [35.1480, 136.9280],
        "御器所": [35.1520, 136.9250],
        "桜山": [35.1420, 136.9200],
        "吹上": [35.1580, 136.9320],
        
        "名古屋市瑞穂区": [35.1317, 136.9350],
        "瑞穂運動場": [35.1280, 136.9380],
        "新瑞橋": [35.1350, 136.9320],
        "瑞穂通": [35.1300, 136.9400],
        "堀田": [35.1250, 136.9280],
        "妙音通": [35.1380, 136.9420],
        
        "名古屋市熱田区": [35.1283, 136.9100],
        "神宮前": [35.1250, 136.9080],
        "熱田": [35.1300, 136.9050],
        "日比野": [35.1320, 136.9000],
        "六番町": [35.1200, 136.8950],
        "伝馬": [35.1350, 136.9150],
        
        "名古屋市中川区": [35.1417, 136.8550],
        "高畑": [35.1380, 136.8600],
        "八田": [35.1450, 136.8450],
        "中島": [35.1350, 136.8400],
        "荒子": [35.1500, 136.8500],
        "尾頭橋": [35.1480, 136.8700],
        "山王": [35.1400, 136.8650],
        "露橋": [35.1300, 136.8550],
        
        "名古屋市港区": [35.1067, 136.8850],
        "港陽": [35.1100, 136.8900],
        "築地口": [35.1050, 136.8950],
        "東海通": [35.1000, 136.8800],
        "名港": [35.0950, 136.8750],
        "稲永": [35.0900, 136.8700],
        "野跡": [35.0850, 136.8650],
        "当知": [35.1150, 136.8850],
        
        "名古屋市南区": [35.0950, 136.9317],
        "笠寺": [35.0900, 136.9400],
        "道徳": [35.1000, 136.9250],
        "豊田": [35.1050, 136.9200],
        "大江": [35.0850, 136.9150],
        "柴田": [35.0950, 136.9350],
        "鳴尾": [35.0800, 136.9450],
        
        "名古屋市守山区": [35.2033, 136.9767],
        "小幡": [35.2000, 136.9700],
        "喜多山": [35.2050, 136.9650],
        "大森": [35.1950, 136.9800],
        "瓢箪山": [35.2100, 136.9750],
        "志段味": [35.2200, 136.9850],
        "吉根": [35.2250, 136.9950],
        "上志段味": [35.2300, 137.0000],
        
        "名古屋市緑区": [35.0717, 136.9533],
        "徳重": [35.0650, 136.9600],
        "平手": [35.0700, 136.9650],
        "神沢": [35.0750, 136.9550],
        "鳴海": [35.0800, 136.9500],
        "有松": [35.0680, 136.9700],
        "大高": [35.0550, 136.9450],
        "南大高": [35.0500, 136.9400],
        
        "名古屋市名東区": [35.1767, 137.0100],
        "星ヶ丘": [35.1650, 136.9850],
        "一社": [35.1700, 136.9950],
        "上社": [35.1750, 137.0050],
        "本郷": [35.1800, 137.0150],
        "藤が丘": [35.1850, 137.0250],
        "猪高台": [35.1720, 137.0200],
        "極楽": [35.1680, 137.0300],
        
        "名古屋市天白区": [35.1233, 136.9750],
        "塩釜口": [35.1300, 136.9800],
        "植田": [35.1250, 136.9850],
        "原": [35.1200, 136.9900],
        "平針": [35.1150, 136.9950],
        "野並": [35.1100, 136.9700],
        "相生山": [35.1050, 136.9750],
        
        // その他の市町村
        "豊橋市": [34.7692, 137.3913],
        "岡崎市": [34.9544, 137.1744],
        "一宮市": [35.3039, 136.8031],
        "瀬戸市": [35.2236, 137.0842],
        "半田市": [34.8923, 136.9373],
        "春日井市": [35.2477, 136.9713],
        "豊川市": [34.8272, 137.3757],
        "津島市": [35.1770, 136.7412],
        "碧南市": [34.8861, 136.9914],
        "刈谷市": [35.0031, 137.0017],
        "豊田市": [35.0825, 137.1562],
        "安城市": [34.9589, 137.0805],
        "西尾市": [34.8622, 137.0617],
        "蒲郡市": [34.8270, 137.2193],
        "犬山市": [35.3784, 136.9448],
        "常滑市": [34.8876, 136.8316],
        "江南市": [35.3320, 136.8706],
        "小牧市": [35.2911, 136.9116],
        "稲沢市": [35.2481, 136.7806],
        "新城市": [34.9006, 137.4982],
        "東海市": [35.0225, 136.9023],
        "大府市": [35.0119, 136.9637],
        "知多市": [34.9950, 136.8644],
        "知立市": [35.0014, 137.0502],
        "尾張旭市": [35.2164, 137.0354],
        "高浜市": [34.9276, 136.9876],
        "岩倉市": [35.2797, 136.8714],
        "豊明市": [35.0536, 137.0130],
        "日進市": [35.1318, 137.0389],
        "田原市": [34.6657, 137.2643],
        "愛西市": [35.1535, 136.7283],
        "清須市": [35.2001, 136.8432],
        "北名古屋市": [35.2459, 136.8650],
        "弥富市": [35.1113, 136.7244],
        "みよし市": [35.0894, 137.0744],
        "あま市": [35.1704, 136.8033],
        "長久手市": [35.1843, 137.0487],
        "東郷町": [35.0970, 137.0507],
        "豊山町": [35.2442, 136.9128],
        "大口町": [35.3315, 136.9078],
        "扶桑町": [35.3598, 136.9115],
        "大治町": [35.1755, 136.8178],
        "蟹江町": [35.1322, 136.7865],
        "飛島村": [35.0892, 136.7925],
        "阿久比町": [34.9345, 136.9116],
        "東浦町": [34.9517, 136.9637],
        "南知多町": [34.7194, 136.9281],
        "美浜町": [34.7772, 136.9067],
        "武豊町": [34.8510, 136.9145],
        "幸田町": [34.8645, 137.1657],
        "設楽町": [35.0974, 137.5725],
        "東栄町": [35.0765, 137.7004],
        "豊根村": [35.1426, 137.7271]
    };

    // 地図の初期化
    const map = L.map('map').setView([35.1804, 136.9065], 10);

    // OpenStreetMapタイルレイヤーの追加（標準的な地図）
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        maxZoom: 19
    }).addTo(map);

    // カラースケールの定義
    function getColor(income) {
        return income > 650 ? '#800026' :
               income > 600 ? '#BD0026' :
               income > 550 ? '#E31A1C' :
               income > 500 ? '#FC4E2A' :
               income > 480 ? '#FD8D3C' :
               income > 450 ? '#FEB24C' :
               income > 420 ? '#FED976' :
               income > 400 ? '#FFEDA0' :
                              '#FFFFCC';
    }

    // ヒートマップデータの準備（大量のデータポイント）
    const heatData = [];
    let totalDataPoints = 0;
    
    // 詳細データから大量のポイントを生成
    for (const [city, data] of Object.entries(detailedIncomeData)) {
        if (typeof data === 'object' && data.subAreas) {
            // メインエリア
            if (cityCoordinates[city]) {
                const [lat, lng] = cityCoordinates[city];
                const intensity = data.income / 700;
                
                // メインポイント
                heatData.push([lat, lng, intensity]);
                totalDataPoints++;
                
                // メインエリア周辺に追加ポイント（20個）
                for (let i = 0; i < 20; i++) {
                    const angle = (Math.PI * 2 * i) / 20;
                    const distance = 0.005 + Math.random() * 0.015;
                    const subLat = lat + Math.cos(angle) * distance;
                    const subLng = lng + Math.sin(angle) * distance;
                    const subIntensity = intensity * (0.8 + Math.random() * 0.2);
                    heatData.push([subLat, subLng, subIntensity]);
                    totalDataPoints++;
                }
            }
            
            // サブエリアのデータポイント
            for (const [subArea, subIncome] of Object.entries(data.subAreas)) {
                if (cityCoordinates[subArea]) {
                    const [subLat, subLng] = cityCoordinates[subArea];
                    const subIntensity = subIncome / 700;
                    
                    // サブエリアのメインポイント
                    heatData.push([subLat, subLng, subIntensity]);
                    totalDataPoints++;
                    
                    // サブエリア周辺に追加ポイント（15個）
                    for (let j = 0; j < 15; j++) {
                        const angle = (Math.PI * 2 * j) / 15;
                        const distance = 0.003 + Math.random() * 0.01;
                        const pointLat = subLat + Math.cos(angle) * distance;
                        const pointLng = subLng + Math.sin(angle) * distance;
                        const pointIntensity = subIntensity * (0.85 + Math.random() * 0.15);
                        heatData.push([pointLat, pointLng, pointIntensity]);
                        totalDataPoints++;
                    }
                    
                    // より細かい中間点を追加（10個）
                    for (let k = 0; k < 10; k++) {
                        const randLat = subLat + (Math.random() - 0.5) * 0.02;
                        const randLng = subLng + (Math.random() - 0.5) * 0.02;
                        const randIntensity = subIntensity * (0.7 + Math.random() * 0.3);
                        heatData.push([randLat, randLng, randIntensity]);
                        totalDataPoints++;
                    }
                }
            }
        }
    }
    
    // その他の市町村のデータも追加
    const simpleIncomeData = {
        "瀬戸市": 480, "半田市": 510, "豊川市": 480,
        "津島市": 440, "碧南市": 520, "西尾市": 490,
        "蒲郡市": 470, "犬山市": 510, "常滑市": 480,
        "江南市": 470, "稲沢市": 480, "新城市": 430,
        "知多市": 520, "知立市": 540, "尾張旭市": 550,
        "高浜市": 510, "岩倉市": 500, "豊明市": 520,
        "田原市": 480, "愛西市": 450, "清須市": 510,
        "北名古屋市": 520, "弥富市": 490, "あま市": 460,
        "東郷町": 590, "豊山町": 520, "大口町": 530,
        "扶桑町": 490, "大治町": 500, "蟹江町": 490,
        "飛島村": 550, "阿久比町": 510, "東浦町": 530,
        "南知多町": 430, "美浜町": 440, "武豊町": 500,
        "幸田町": 560, "設楽町": 400, "東栄町": 380,
        "豊根村": 390
    };
    
    for (const [city, income] of Object.entries(simpleIncomeData)) {
        if (cityCoordinates[city]) {
            const [lat, lng] = cityCoordinates[city];
            const intensity = income / 700;
            
            heatData.push([lat, lng, intensity]);
            totalDataPoints++;
            
            // 各市町村に追加ポイント（25個）
            for (let i = 0; i < 25; i++) {
                const angle = (Math.PI * 2 * i) / 25;
                const distance = 0.01 + Math.random() * 0.03;
                const subLat = lat + Math.cos(angle) * distance;
                const subLng = lng + Math.sin(angle) * distance;
                const subIntensity = intensity * (0.7 + Math.random() * 0.3);
                heatData.push([subLat, subLng, subIntensity]);
                totalDataPoints++;
            }
        }
    }

    // データポイント数を表示
    document.getElementById('dataPoints').textContent = `総データポイント: ${totalDataPoints.toLocaleString()}個`;

    // ヒートマップレイヤーの作成
    const heat = L.heatLayer(heatData, {
        radius: 20,
        blur: 15,
        maxZoom: 17,
        max: 1.0,
        gradient: {
            0.0: 'blue',
            0.2: 'cyan',
            0.4: 'lime',
            0.6: 'yellow',
            0.8: 'orange',
            1.0: 'red'
        }
    }).addTo(map);

    // 主要エリアにマーカーを追加
    for (const [city, data] of Object.entries(detailedIncomeData)) {
        if (cityCoordinates[city] && typeof data === 'object') {
            const [lat, lng] = cityCoordinates[city];
            const marker = L.circleMarker([lat, lng], {
                radius: 8,
                fillColor: getColor(data.income),
                color: '#fff',
                weight: 2,
                opacity: 0.9,
                fillOpacity: 0.8
            }).addTo(map);
            
            let popupContent = `
                <div style="font-size: 14px; padding: 5px;">
                    <strong>${city}</strong><br>
                    平均世帯年収: <span style="color: ${getColor(data.income)}; font-weight: bold;">
                        ${data.income}万円
                    </span>`;
            
            if (data.subAreas) {
                popupContent += `<br><br><strong>地区別:</strong><br>`;
                for (const [subArea, subIncome] of Object.entries(data.subAreas)) {
                    popupContent += `${subArea}: ${subIncome}万円<br>`;
                }
            }
            
            popupContent += `</div>`;
            marker.bindPopup(popupContent);
        }
    }

    // 情報コントロールの追加
    const info = L.control();
    info.onAdd = function (map) {
        this._div = L.DomUtil.create('div', 'info');
        this.update();
        return this._div;
    };

    info.update = function () {
        this._div.innerHTML = '<h4>愛知県 世帯年収ヒートマップ</h4>' +
            '<div class="info-details">' +
            '<p><strong>データ表示：</strong></p>' +
            '<p>🔴 赤色: 高所得地域（600万円以上）</p>' +
            '<p>🟡 黄色: 中所得地域（500-600万円）</p>' +
            '<p>🔵 青色: 低所得地域（500万円未満）</p>' +
            '<p style="margin-top: 10px; font-size: 11px; color: #666;">※ マーカーをクリックで詳細表示<br>※ ズームで詳細度が変化</p>' +
            '</div>';
    };

    info.addTo(map);

    // 凡例の追加
    const legend = L.control({position: 'bottomright'});
    legend.onAdd = function (map) {
        const div = L.DomUtil.create('div', 'info legend');
        const grades = [0, 400, 420, 450, 480, 500, 550, 600, 650];
        
        div.innerHTML = '<h4 style="margin-bottom: 10px;">世帯年収（万円）</h4>';
        
        for (let i = 0; i < grades.length; i++) {
            div.innerHTML +=
                '<i style="background:' + getColor(grades[i] + 1) + '"></i> ' +
                grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] + '<br>' : '+');
        }
        
        return div;
    };
    legend.addTo(map);

    // ローディング画面を非表示
    setTimeout(() => {
        document.getElementById('loading').style.display = 'none';
    }, 1500);

    // ズームレベルに応じてヒートマップの表示を調整
    map.on('zoomend', function() {
        const zoom = map.getZoom();
        if (zoom > 12) {
            heat.setOptions({radius: 10, blur: 8});
        } else if (zoom > 10) {
            heat.setOptions({radius: 15, blur: 12});
        } else {
            heat.setOptions({radius: 20, blur: 15});
        }
    });
</script>
```

</body>
</html>
